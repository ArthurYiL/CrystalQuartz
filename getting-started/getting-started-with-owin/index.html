<!DOCTYPE html>
<html>
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-121536364-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-121536364-1');
    </script>

    <meta charset="utf-8">
  
  <title>Crystal Quartz Docs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">

  <link rel="stylesheet" href="/CrystalQuartz/css/style.css">
  <link rel="stylesheet" href="/CrystalQuartz/css/highlightjs_theme.css">
</head>
<body>

<aside id="main-sidebar">
  <h1 id="main-logo">
    <a href="https://github.com/guryanovev/CrystalQuartz" style="float: right;">
      <img src="/CrystalQuartz/images/GitHub-Mark-Light-32px.png" />
    </a>

    <a href="/CrystalQuartz/" id="logo">Crystal Quartz Docs</a></h1>

  <p id="project-info">Crystal Quartz Panel is a lightweight, completely pluggable module for displaying Quartz.NET scheduler jobs information.</p>

  <section id="sidebar-badges">
    <a href="https://travis-ci.org/guryanovev/CrystalQuartz"><img src="https://travis-ci.org/guryanovev/CrystalQuartz.svg?branch=master" /></a>
    <a href="https://gitter.im/guryanovev/CrystalQuartz?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge">
      <img src="https://badges.gitter.im/Join%20Chat.svg" />
    </a>

    
  </section>

  <nav id="main-navigation">
      
      
      <ul>
          

          <li class="">
              <a href="/CrystalQuartz/categories/getting-started/">Getting Started</a>

              
              <ul>
                  
                  <li class="">
                    <a href="/CrystalQuartz/getting-started/getting-started-with-asp-dot-net-core/" class="">Getting Started with ASP.NET Core</a>
                  </li>
                  
                  <li class="active">
                    <a href="/CrystalQuartz/getting-started/getting-started-with-owin/" class="">Getting Started with OWIN</a>
                  </li>
                  
              </ul>
              

          </li>
          

          <li class="">
              <a href="/CrystalQuartz/categories/advanced-config/">Advanced Configuration</a>

              

          </li>
          
      </ul>
      

  </nav>
</aside>

<section id="main-content">
  <header id="article-header">
    <nav>
        <ul>
            <li><a href="/CrystalQuartz/">Home</a></li>
            <li>
                <a class="article-category-link" href="/CrystalQuartz/categories/getting-started/">Getting Started</a>
            </li>
        </ul>
    </nav>

    
  
    <h1 class="article-title" itemprop="name">
      Getting Started with OWIN
    </h1>
  

</header>

<article id="post-getting-started-with-owin" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This article describes how you can use OWIN version of CrystalQuartz to
plug <a href="http://www.quartz-scheduler.net/" target="_blank" rel="noopener">Quartz.NET</a> Scheduler viewer into
your application.</p>
<a id="more"></a>
<h2 id="Pre-requirements"><a href="#Pre-requirements" class="headerlink" title="Pre-requirements"></a>Pre-requirements</h2><p>It is assumed that you already have an OWIN application up and running.
That application can be either web or console acting as a self-host for
OWIN pipeline. The only thing that is required is having an instance of
<code>IAppBuilder</code> object available. For web applications it is in <code>Startup.cs</code> 
file and for console app it is exactly where you running the <code>WebServer</code>.</p>
<table class="code-split-table">
<tr class="description">
    <td>Typical entry point for OWIN web-application</td>
    <td>Typical entry point for self-hosted OWIN application</td>
</tr>
<tr class="code">
<td>
<figure class="highlight cs"><figcaption><span>Startup.cs</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">Startup</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Configuration</span>(<span class="params">IAppBuilder app</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// CrystalQuartz will be configured here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</td>
<td>
<figure class="highlight cs"><figcaption><span>Program.cs</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        WebApp.Start(</span><br><span class="line">            <span class="string">"http://localhost:3000"</span>, </span><br><span class="line">            (IAppBuilder app) =&gt; &#123;</span><br><span class="line">                <span class="comment">// CrystalQuartz will be configured here</span></span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</td>
</tr>
</table>

<p>It is also assumed you have Quartz.NET v2 or v3 installed and the scheduler 
instance available.</p>
<h2 id="1-Setup"><a href="#1-Setup" class="headerlink" title="1 Setup"></a>1 Setup</h2><p>As a first step, you need to install
<a href="http://nuget.org/List/Packages/CrystalQuartz.Owin" target="_blank" rel="noopener">CrystalQuartz.Owin</a>
NuGet package to the target project:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Install-Package CrystalQuartz.Owin</span><br></pre></td></tr></table></figure>
<p>That will add a <code>CrystalQuartz.Owin.dll</code> reference to your project.
The <code>CrystalQuartz.Owin.dll</code> is a single dll that contains all the
resources needed for CrystalQuartz to work.</p>
<h2 id="2-Configuration"><a href="#2-Configuration" class="headerlink" title="2 Configuration"></a>2 Configuration</h2><p>As a next step, you need to hook CrystalQuartz middleware into your 
OWIN pipeline. It should be done by calling <code>UseCrystalQuartz</code> 
extension method at the moment of the pipeline initialization. </p>
<p>Make sure to add the using statement at the top of the entry point file.</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> CrystalQuartz.Owin;</span><br></pre></td></tr></table></figure>
<p>The generic syntax for panel configuration should be placed in the entry 
point method:</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * app is your IAppBuilder instance</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">app.UseCrystalQuartz(schedulerProvider, options);</span><br></pre></td></tr></table></figure>
<p>The arguments are:</p>
<ul>
<li><code>schedulerOrProvider</code> is a provider pointing to the scheduler instance;</li>
<li><code>options</code> is an optional object for panel customization.</li>
</ul>
<h3 id="2-1-Configuration-Scheduler"><a href="#2-1-Configuration-Scheduler" class="headerlink" title="2.1 Configuration - Scheduler"></a>2.1 Configuration - Scheduler</h3><p>This section describes different ways of passing <code>schedulerProvider</code> argument
to the <code>UseCrystalQuartz</code> method. You need to pick one of these options.</p>
<h4 id="2-1-1-Scheduler-provider"><a href="#2-1-1-Scheduler-provider" class="headerlink" title="2.1.1 Scheduler provider"></a>2.1.1 Scheduler provider</h4><p>If you already have an <code>IScheduler</code> object instance then you can pass a <code>Func</code> 
pointing to it to the configuration extension method:</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Configuration</span>(<span class="params">IAppBuilder app</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    IScheduler scheduler = CreateScheduler();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Init CrystalQuartz Panel with scheduler instance.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    app.UseCrystalQuartz(() =&gt; scheduler);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> IScheduler <span class="title">CreateScheduler</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    IScheduler scheduler = StdSchedulerFactory.GetDefaultScheduler();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// define the job and tie it to our HelloJob class</span></span><br><span class="line">    IJobDetail job = JobBuilder.Create&lt;HelloJob&gt;()</span><br><span class="line">        .WithIdentity(<span class="string">"job1"</span>, <span class="string">"group1"</span>)</span><br><span class="line">        .Build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Trigger the job to run now, and then repeat every 10 seconds</span></span><br><span class="line">    ITrigger trigger = TriggerBuilder.Create()</span><br><span class="line">        .WithIdentity(<span class="string">"trigger1"</span>, <span class="string">"group1"</span>)</span><br><span class="line">        .StartNow()</span><br><span class="line">        .WithSimpleSchedule(x =&gt; x</span><br><span class="line">        .WithIntervalInSeconds(<span class="number">10</span>)</span><br><span class="line">        .RepeatForever())</span><br><span class="line">        .Build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Tell quartz to schedule the job using our trigger</span></span><br><span class="line">    scheduler.ScheduleJob(job, trigger);</span><br><span class="line"></span><br><span class="line">    scheduler.Start();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> scheduler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Using this technique you can manually configure panel to work with a
remote scheduler:</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Configuration</span>(<span class="params">IAppBuilder app</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">string</span> url = <span class="string">"tcp://localhost:555/QuartzScheduler"</span>; <span class="comment">// YOUR URL HERE</span></span><br><span class="line"></span><br><span class="line">    NameValueCollection properties = <span class="keyword">new</span> NameValueCollection();</span><br><span class="line">    properties[<span class="string">"quartz.scheduler.proxy"</span>] = <span class="string">"true"</span>;</span><br><span class="line">    properties[<span class="string">"quartz.scheduler.proxy.address"</span>] = url; </span><br><span class="line"></span><br><span class="line">    ISchedulerFactory schedulerFactory = <span class="keyword">new</span> StdSchedulerFactory(properties);</span><br><span class="line">    IScheduler scheduler = schedulerFactory.GetScheduler();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Init CrystalQuartz Panel with Remote scheduler instance.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    app.UseCrystalQuartz(() =&gt; scheduler);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You can get it from an IoC container:</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Configuration</span>(<span class="params">IAppBuilder app</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">     * Make sure your scheduler is configured</span></span><br><span class="line"><span class="comment">     * as singleton in the IoC container </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    app.UseCrystalQuartz(() =&gt; container.Resolve&lt;IScheduler&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-1-2-Legacy-Scheduler-provider"><a href="#2-1-2-Legacy-Scheduler-provider" class="headerlink" title="2.1.2 Legacy Scheduler provider"></a>2.1.2 Legacy Scheduler provider</h4><p>Non-OWIN version of CrystalQuartz Panel uses internal <code>ISchedulerProvider</code> abstraction for 
getting access to the scheduler instance. You can pass an instance of <code>ISchedulerProvider</code> 
as a first argument of <code>UseCrystalQuartz</code> call. That might be helpful in some rare cases.</p>
<p>If you are migrating from <a href="http://nuget.org/List/Packages/CrystalQuartz.Simple" target="_blank" rel="noopener">CrystalQuartz.Simple</a> to 
<a href="http://nuget.org/List/Packages/CrystalQuartz.Owin" target="_blank" rel="noopener">CrystalQuartz.Owin</a> and you already have 
your custom implementation of <code>ISchedulerProvider</code>: </p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MySchedulerProvider</span> : <span class="title">ISchedulerProvider</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">object</span> <span class="title">CreateScheduler</span>(<span class="params">ISchedulerEngine engine</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        IScheduler scheduler = StdSchedulerFactory.GetDefaultScheduler();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> jobDetail = JobBuilder.Create&lt;HelloJob&gt;()</span><br><span class="line">            .WithIdentity(<span class="string">"myJob"</span>)</span><br><span class="line">            .StoreDurably()</span><br><span class="line">            .Build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> trigger = TriggerBuilder.Create()</span><br><span class="line">            .WithIdentity(<span class="string">"myTrigger"</span>)</span><br><span class="line">            .StartNow()</span><br><span class="line">            .WithSimpleSchedule(x =&gt; x.WithIntervalInMinutes(<span class="number">1</span>).RepeatForever())</span><br><span class="line">            .Build();</span><br><span class="line"></span><br><span class="line">        scheduler.ScheduleJob(jobDetail, trigger);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In this case you can pass the same provider instance to the <code>UseCrystalQuartz</code> call:</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Configuration</span>(<span class="params">IAppBuilder app</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">    app.UseCrystalQuartz(<span class="keyword">new</span> MySchedulerProvider());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If you are going to connect to a remote scheduler the <code>RemoteSchedulerProvider</code> 
implementation of <code>ISchedulerProvider</code> would be more concise than the explicit
configuration:</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Startup</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Configuration</span>(<span class="params">IAppBuilder app</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        app.UseCrystalQuartz(<span class="keyword">new</span> RemoteSchedulerProvider</span><br><span class="line">        &#123;</span><br><span class="line">            SchedulerHost = <span class="string">"tcp://localhost:555/QuartzScheduler"</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-Options"><a href="#2-2-Options" class="headerlink" title="2.2 Options"></a>2.2 Options</h3><p>Second (optional) argument of <code>UseCrystalQuartz</code> method allows to do some panel customizations. 
The object should be an instance of <code>CrystalQuartzOptions</code> class. Please check the <a href="https://github.com/guryanovev/CrystalQuartz/blob/master/src/CrystalQuartz.Application/CrystalQuartzOptions.cs" target="_blank" rel="noopener">options class
source code</a> for details.</p>
<h2 id="3-Running-the-panel"><a href="#3-Running-the-panel" class="headerlink" title="3 Running the panel"></a>3 Running the panel</h2><p>Once the configuration is done, you can run your project and navigate to <code>http://YOUR_URL/quartz</code> 
to see the panel UI. </p>
<h2 id="4-Examples"><a href="#4-Examples" class="headerlink" title="4 Examples"></a>4 Examples</h2><p>Please check these samples demonstrating different cases of using CrystalQuartz with OWIN environment:</p>
<ul>
<li><a href="//github.com/guryanovev/CrystalQuartz/tree/master/examples/01_Owin_SelfHosted">OWIN Self-hosted console app example</a></li>
<li><a href="//github.com/guryanovev/CrystalQuartz/tree/master/examples/02_Owin_Web_Simple">OWIN Simple site</a></li>
<li><a href="//github.com/guryanovev/CrystalQuartz/tree/master/examples/03_Owin_Web_Remote">OWIN Web site + remote</a></li>
</ul>

      
    </div>
  </div>
</article>

<footer id="article-footer">
    Page updated at <span>Mon Feb 04 2019 15:15:58 GMT+0000</span>
    <a href="https://github.com/guryanovev/CrystalQuartz/blob/master/docs/source/_posts/getting-started-with-owin.md">Edit this page on GitHub</a>
</footer>
</section>

</body>
</html>